<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.2a2e8bb52aecb62123aa.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5;--color-bg-dark:#282c35;--color-text-dark:hsla(0,0%,100%,0.88);--color-heading-dark:#ffa7c4;--color-heading-black-dark:#fff}*,:after,:before{box-sizing:border-box}html{line-height:var(--lineHeight-normal);font-size:var(--fontSize-root);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-body);font-size:var(--fontSize-1)}body.light-mode{color:var(--color-text)}body.dark-mode{color:var(--color-text-dark);background-color:var(--color-bg-dark)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);height:1px;border:0}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);margin-top:var(--spacing-12);margin-bottom:var(--spacing-6);line-height:var(--lineHeight-tight);letter-spacing:-.025em}h2.light-mode,h3.light-mode,h4.light-mode,h5.light-mode,h6.light-mode{font-weight:var(--fontWeight-bold);color:var(--color-heading)}h2.dark-mode,h3.dark-mode,h4.dark-mode,h5.dark-mode,h6.dark-mode{font-weight:var(--fontWeight-bold);color:var(--color-heading-dark)}h1{font-weight:var(--fontWeight-black);font-size:var(--fontSize-5)}h1.light{color:var(--color-heading-black)}h1.dark{color:var(--color-heading-black-dark)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{line-height:var(--lineHeight-relaxed);--baseline-multiplier:0.179;--x-height-multiplier:0.35;margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{margin-left:var(--spacing-0);margin-right:var(--spacing-0);margin-bottom:var(--spacing-8);list-style-position:outside;list-style-image:none}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{color:var(--color-text-light);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6);border-left:var(--spacing-1) solid var(--color-primary);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{width:100%;margin-bottom:var(--spacing-8);border-collapse:collapse;border-spacing:.25rem}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12);display:flex;flex-direction:row;justify-content:space-between}.main-heading{font-size:var(--fontSize-5);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-weight:var(--fontWeight-bold);font-family:var(--font-heading);text-decoration:none;font-size:var(--fontSize-2)}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio-avatar,.bio p{margin-bottom:var(--spacing-0)}.bio-avatar{margin-right:var(--spacing-4);min-width:50px;border-radius:100%}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-size:var(--fontSize-2);font-family:var(--font-heading)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4);margin-left:var(--spacing-0)}ol,ul{list-style-position:inside}}.tag-view{display:inline-block;margin-right:1rem;border-width:1px;border-style:solid;padding:0 .5rem;border-radius:3px;cursor:pointer}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle--disabled{cursor:not-allowed;opacity:.5;transition:opacity .25s}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#4d4d4d;transition:all .2s ease}.react-toggle:hover:not(.react-toggle--disabled) .react-toggle-track{background-color:#000}.react-toggle--checked .react-toggle-track{background-color:#19ab27}.react-toggle--checked:hover:not(.react-toggle--disabled) .react-toggle-track{background-color:#128d15}.react-toggle-track-check{position:absolute;width:14px;height:10px;top:4px;margin-top:auto;margin-bottom:auto;line-height:0;left:8px;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:10px;height:10px;top:4px;margin-top:auto;margin-bottom:auto;line-height:0;right:10px}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;position:absolute;top:1px;left:1px;width:22px;height:22px;border:1px solid #4d4d4d;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .25s ease}.react-toggle--checked .react-toggle-thumb{left:27px;border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #0099e0}.react-toggle:active:not(.react-toggle--disabled) .react-toggle-thumb{box-shadow:0 0 5px 5px #0099e0}</style><meta name="generator" content="Gatsby 3.4.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=cb0348da83085f341829f81b843fa542" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=cb0348da83085f341829f81b843fa542"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=cb0348da83085f341829f81b843fa542"/><title data-react-helmet="true">React核心原理浅析 | 按太阳穴轮刮眼眶</title><meta data-react-helmet="true" name="description" content="对React的核心原理进行分析,包括JSX、Diffing、Fiber、Time Slice等."/><meta data-react-helmet="true" property="og:title" content="React核心原理浅析"/><meta data-react-helmet="true" property="og:description" content="对React的核心原理进行分析,包括JSX、Diffing、Fiber、Time Slice等."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content=""/><meta data-react-helmet="true" name="twitter:title" content="React核心原理浅析"/><meta data-react-helmet="true" name="twitter:description" content="对React的核心原理进行分析,包括JSX、Diffing、Fiber、Time Slice等."/><link as="script" rel="preload" href="/webpack-runtime-523b8afb0042468c77d7.js"/><link as="script" rel="preload" href="/framework-e954ed135b27c92e5196.js"/><link as="script" rel="preload" href="/app-065bd1c7906a1152e68e.js"/><link as="script" rel="preload" href="/commons-05ebe9de21711bd0a6d1.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-97982a6270918782dbd4.js"/><link as="fetch" rel="preload" href="/page-data/react/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>!function(e,a,o){function d(e){document.body.classList.add(e?"dark-mode":"light-mode"),document.body.classList.remove(e?"light-mode":"dark-mode")}var t=window.matchMedia("(prefers-color-scheme: dark)"),r="(prefers-color-scheme: dark)"===t.media,s=null;try{s=localStorage.getItem("darkMode")}catch(e){}var c=null!==s;if(c&&(s=JSON.parse(s)),c)d(s);else if(r)d(t.matches),localStorage.setItem("darkMode",t.matches);else{var l=document.body.classList.contains("dark-mode");localStorage.setItem("darkMode",JSON.stringify(l))}}();</script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">按太阳穴轮刮眼眶</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">React核心原理浅析</h1><p>July 18, 2021</p></header><section itemProp="articleBody"><h1>1. JSX 与虚拟 DOM</h1>
<p>我们从 React 官方文档开头最基本的一段 Hello World 代码入手:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello, world!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>很明显, 这段代码的意思是通过 <code class="language-text">ReactDOM.render()</code> 方法将 <code class="language-text">h1</code> 包裹的 JSX 元素渲染到 id 为“root”的 HTML 元素上. 除了在 JS 中早已熟知的 <code class="language-text">document.getElementById()</code> 方法外, 这段代码中还包含两个知识点:</p>
<ul>
<li>以 <code class="language-text">h1</code> 标签包裹的 JSX 元素</li>
<li><code class="language-text">ReactDOM.render()</code> 方法</li>
</ul>
<p>而这两个知识点则对应着 React 中要解决的核心问题:</p>
<ul>
<li>为何以及如何使用(JSX 表示的)虚拟 DOM?</li>
<li>如何对虚拟 DOM 进行处理, 使其高效地渲染出来?</li>
</ul>
<h3>1.1 虚拟 DOM 是什么? 为何要使用虚拟 DOM?</h3>
<p>虚拟 DOM 其实就是用 JavaScript 对象表示的一个 DOM 节点, 内部包含了节点的 <code class="language-text">tag</code> , <code class="language-text">props</code> 和 <code class="language-text">children</code> .</p>
<p>为何使用虚拟 DOM? 因为直接操作真实 DOM 繁琐且低效, 通过虚拟 DOM, 将一部分昂贵的浏览器重绘工作转移到相对廉价的存储和计算资源上.</p>
<h3>1.2 如何将 JSX 转换成虚拟 DOM?</h3>
<p>通过 babel 可以将 JSX 编译为特定的 JavaScript 对象, 示例代码如下:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// JSX</span>
<span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Title</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span>
<span class="token comment">// babel编译结果(React17之前), 注意子元素的嵌套结构</span>
<span class="token keyword">var</span> e <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token string">"div"</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">"root"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"h1"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> className<span class="token operator">:</span> <span class="token string">"title"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Title"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// React17之后编译结果有所区别, 创建节点的方法由react导出, 但基本原理大同小异</span></code></pre></div>
<h3>1.3 如何将虚拟 DOM 渲染出来?</h3>
<p>很明显, 虚拟 DOM 中包含了创建 DOM 所需的各种信息, 对于首次渲染, 直接依照这些信息创建 DOM 节点即可.</p>
<p>但虚拟 DOM 的真正价值在于“更新”: 当一个 list 中的某些项发生了变化, 或删除或增加了若干项, 如何通过对比前后的虚拟 DOM 树, 最小化地更新真实 DOM? 这就是 React 的核心目标.</p>
<h1>2. React Diffing</h1>
<p>“Diffing”即“找不同”, 就是解决上文引出的 React 的核心目标——如何通过对比新旧虚拟 DOM 树, 以在最小的操作次数下将旧 DOM 树转换为新 DOM 树.</p>
<p>在算法领域中, 两棵树的转换目前最优的算法复杂度为 <code class="language-text">O(n**3)</code> , n 为节点个数. 这意味着当树上有 1000 个元素时, 需要 10 亿次比较, 显然远远不够高效.</p>
<p>React 在基于以下两个假设的基础上, 提出了一套复杂度为 <code class="language-text">O(n)</code> 的启发式算法</p>
<ol>
<li>不同类型(即标签名、组件名)的元素会产生不同的树;</li>
<li>通过设置 <code class="language-text">key</code> 属性来标识一组同级子元素在渲染前后是否保持不变.</li>
</ol>
<p>在实践中, 以上两个假设在绝大多数场景下都成立.</p>
<h2>2.1 Diffling 算法描述</h2>
<h3>不同类型的元素/组件</h3>
<p>当元素的标签或组件名发生变化, 直接卸载并替换以此元素作为根节点的整个子树.</p>
<h3>同一类型的元素</h3>
<p>当元素的标签相同时, React 保留此 DOM 节点, 仅对比和更新有改变的属性, 如 className、title 等, 然后递归对比其子节点.</p>
<p>对于 <code class="language-text">style</code> 属性, React 会继续深入对比, 仅更新有改变的属性, 如 color、fontSize 等.</p>
<h3>同一类型的组件</h3>
<p>当组件的 props 更新时, 组件实例保持不变, React 调用组件的 <code class="language-text">componentWillReceiveProps()</code> <code class="language-text">componentWillUpdate()</code> 和 <code class="language-text">componentDidUpdate()</code> 生命周期方法, 并执行 <code class="language-text">render()</code> 方法.</p>
<p>Diffing 算法会递归比对新旧 <code class="language-text">render()</code> 执行的结果.</p>
<h3>对子节点的递归</h3>
<p>当一组同级子节点(列表)的末尾添加了新的子节点时, 上述 Diffing 算法的开销较小; 但当新元素被插入到列表开头时, Diffing 算法只能按顺序依次比对并重建从新元素开始的后续所有子节点, 造成极大的开销浪费.</p>
<p>解决方案是为一组列表项添加 <code class="language-text">key</code> 属性, 这样 React 就可以方便地比对出插入或删除项了.</p>
<p>关于 <code class="language-text">key</code> 属性, 应稳定、可预测且在列表内唯一(无需全局唯一), 如果数据有 ID 的话直接使用此 ID 作为 <code class="language-text">key</code>, 或者利用数据中的一部分字段哈希出一个 key 值.</p>
<p>避免使用数组索引值作为 <code class="language-text">key</code>, 因为当插入或删除元素后, 之后的元素和索引值的对应关系都会发生错乱, 导致错误的比对结果.</p>
<p>避免使用不稳定的 key(如随机数), 因为每次渲染都会发生改变, 从而导致列表项被不必要地重建.</p>
<h2>2.2 递归的 Diffing</h2>
<p>在 1.2 节中的虚拟 DOM 对象中可以得知: 虚拟 DOM 树的每个节点通过 <code class="language-text">children</code> 属性构成了一个嵌套的树结构, 这意味着要以递归的形式遍历和比较新旧虚拟 DOM 树.</p>
<p>2.1 节的策略解决了 Diffing 算法的时间复杂度的问题, 但我们还面临着另外一个重大的性能问题——浏览器的渲染线程和 JS 的执行线程是互斥的, 这意味着 DOM 节点过多时, 虚拟 DOM 树的构建和处理会长时间占用主线程, 使得一些需要高优先级处理的操作如用户输入、平滑动画等被阻塞, 严重影响使用体验.</p>
<h3>时间切片(Time Slice)</h3>
<p>为了解决浏览器主线程的阻塞问题, 引出 <strong>时间切片</strong> 的策略——将整个工作流程分解成小的工作单元, 并在浏览器空闲时交由浏览器执行这些工作单元, 每个执行单元执行完毕后, 浏览器都可以选择中断渲染并处理其他需要更高优先级处理的工作.</p>
<p>浏览器中提供了 <code class="language-text">requestIdleCallback</code> 方法实现此功能, 将待调用的函数加入执行队列, 浏览器将在不影响关键事件处理的情况下逐个调用.</p>
<p>考虑到浏览器的兼容性以及 <code class="language-text">requestIdleCallback</code> 方法的不稳定性, React 自己实现了专用于 React 的类似 <code class="language-text">requestIdleCallback</code> 且功能更完备的 <code class="language-text">Scheduler</code> 来实现空闲时触发回调, 并提供了多种优先级供任务设置.</p>
<h3>递归与时间切片</h3>
<p>时间切片策略要求我们将虚拟 DOM 的更新操作分解为小的工作单元, 同时具备以下特性:</p>
<ul>
<li>可暂停、可恢复的更新;</li>
<li>可跳过的重复性、覆盖性更新;</li>
<li>具备优先级的更新.</li>
</ul>
<p>对于递归形式的程序来说, 这些是难以实现的. 于是就需要一个处于递归形式的虚拟 DOM 树上层的数据结构, 来辅助完成这些特性.</p>
<p>这就是 React16 引入的重构后的算法核心——Fiber.</p>
<h1>3. Fiber</h1>
<p>从概念上来说, Fiber 就是重构后的虚拟 DOM 节点, 一个 Fiber 就是一个 JS 对象.</p>
<p>Fiber 节点之间构成 <strong>单向链表</strong> 结构, 以实现前文提到的几个特性: 更新可暂停/恢复、可跳过、可设优先级.</p>
<h2>3.1 Fiber 节点</h2>
<p>一个 Fiber 节点就是一个 JS 对象, 其中的关键属性可分类列举如下:</p>
<ul>
<li>
<p>结构信息(构成链表的指针属性)</p>
<ul>
<li>return: 父节点</li>
<li>child: 第一个子节点</li>
<li>sibling: 右侧第一个兄弟节点</li>
<li>alternate: 本节点在相邻更新时的状态, 用于比较节点前后的变化, 3.3 节详述</li>
</ul>
</li>
<li>
<p>组件信息</p>
<ul>
<li>tag: 组件创建类型, 如 FunctionComponent、ClassComponent、HostComponent 等</li>
<li>key: 即 key 属性</li>
<li>type: 组件类型, Function/Class 组件的 type 就是对应的 Function/Class 本身, Host 组件的 type 就是对应元素的 TagName</li>
<li>stateNode: 对应的真实 DOM 节点</li>
</ul>
</li>
<li>
<p>本次更新的 props 和 state 相关信息</p>
<ul>
<li>pendingProps、memoizedProps</li>
<li>memoizedState</li>
<li>dependencies</li>
<li>updateQueue</li>
</ul>
</li>
<li>
<p>更新标记</p>
<ul>
<li>effectTag: 节点更新类型, 如替换、更新、删除等</li>
<li>nextEffect、firstEffect、lastEffect</li>
</ul>
</li>
<li>优先级相关: lanes、childrenLanes</li>
</ul>
<h2>3.2 Fiber 树</h2>
<p>前文说到, Fiber 节点通过 <code class="language-text">return</code> , <code class="language-text">child</code> 和 <code class="language-text">slibling</code> 属性构成了单向链表结构, 为了与 DOM 树对应, 习惯上仍称其为“树”.</p>
<p>如一棵 DOM 树:</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Section<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>Footer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>其 <code class="language-text">section</code> 节点的 Fiber 可表示为:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> sectionFiber <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">"SECTION_KEY"</span><span class="token punctuation">,</span>
  child<span class="token operator">:</span> h2Fiber<span class="token punctuation">,</span>
  sibling<span class="token operator">:</span> footerFiber<span class="token punctuation">,</span>
  <span class="token keyword">return</span><span class="token operator">:</span> divFiber<span class="token punctuation">,</span>
  alternate<span class="token operator">:</span> oldSectionFiber<span class="token punctuation">,</span>
  <span class="token operator">...</span>otherFiberProps<span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>整体的 Fiber 结构:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 351px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b3457a432995dc057094ab9e3bb38373/7c2a6/DOM.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQ4y5WU12oDUQxE9/9/y2D8YGxccO+9994mHAWZzWYdiECsb5E0M9J1MBgMhLdaLS0WC81mMz0eD2Gv10v/teB0Omk4HKpUKtnG4XDQ7Xb7mJA93/ffYQ9Go5FWq5V2u52KxaL2+33sxTiPRdjv95XNZo1uKpXS5XL5ge6vYO7CkC8OmKDT6Qi/Xq+aTqdar9dG+fl8mruxdzweLRCNz+ezMZvP5+r1eppMJmq32wo2m43wSqVigclkUrlczpJ3u11lMhnl83lbFwoFIRE6w4g9ktVqNWtqtVr9TujVQMAaFNAECcFU986HDYrENhoNi6WIacgG0BOJhB1EOxztfFTX5XL5XgdAhgqJoO1NCdt2u9X9fv84e+HJMIQMM5Q5ADaI6B5UOUO38Xhs80rTKO4yMWro5+gDDukwARgJaEI6nbbLJCmXy4aexDSARADhHmuPtYQkYKhxqvN1AyX6eFebzaY1jUDO0B0pkORN2bvpHhWdoQcNCEEc9yQp8n4pcSJ7QjoLXZCgL5TD44OO7MPC2QR/vVNoQol/I28WmjJmFEICCqAhxev1+m+E4TeMNuEBJjko6D6vCOSuNUaxL8UZzYzW8I5pAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="./DOM.png"
        title="./DOM.png"
        src="/static/b3457a432995dc057094ab9e3bb38373/7c2a6/DOM.png"
        srcset="/static/b3457a432995dc057094ab9e3bb38373/c26ae/DOM.png 158w,
/static/b3457a432995dc057094ab9e3bb38373/6bdcf/DOM.png 315w,
/static/b3457a432995dc057094ab9e3bb38373/7c2a6/DOM.png 351w"
        sizes="(max-width: 351px) 100vw, 351px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>3.3 Fiber 架构</h2>
<p>基于 Fiber 构成的虚拟 DOM 树就是 Fiber 架构.</p>
<p>在 3.1 节中我们介绍过, 在 Fiber 节点中有一个重要属性 <code class="language-text">alternate</code> , 单词意为“备用”.</p>
<p>实际上, 在 React 中最多会同时存在两棵 Fiber 树:</p>
<ul>
<li>当前显示在屏幕上、已经构建完成的 Fiber 树称为“Current Fiber Tree”, 我们将其中的 Fiber 节点简写为 <code class="language-text">currFiber</code>;</li>
<li>当前正在构建的 Fiber 树称为“WorkInProgress Fiber Tree”, 我们将其 Fiber 节点节点简写为 <code class="language-text">wipFiber</code>.</li>
</ul>
<p>而这两棵树中节点的 <code class="language-text">alternate</code> 属性互相指向对方树中的对应节点, 即: <code class="language-text">currFiber.alternate === wipFiber; wipFiber.alternate === currFber;</code> 他们用于对比更新前后的节点以决定如何更新此节点.</p>
<p>在 React 中, 整个应用的根节点为 <code class="language-text">fiberRoot</code> , 当 wipFiber 树构建完成后, <code class="language-text">fiberRoot.current</code> 将从 currFiber 树的根节点切换为 wipFiber 的根节点, 以完成更新操作.</p>
<h3>3.1 基于 Fiber 的调度——时间切片</h3>
<p>在 2.2 节我们讨论了采用拆分工作单元并以时间切片的方式执行, 以避免阻塞主线程. 在 Fiber 架构下, 每个 Fiber 节点就是一个工作单元.</p>
<p>在以下示例代码中, 我们使用浏览器提供的 <code class="language-text">requestIdleCallback</code> 方法演示这个过程, 它会在浏览器空闲时执行一个 workLoop、处理一个 Fiber 节点, 然后可以根据实际情况继续执行或暂停等待执行下一个 workLoop.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> shouldYield <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextUnitOfWork <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>shouldYield<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理一个Fiber节点, 返回下一个Fiber节点, 详见3.3节</span>
    nextUnitOfWork <span class="token operator">=</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span>
    <span class="token comment">// 暂停处理的演示: 当时间不足时取消循环处理过程</span>
    shouldYield <span class="token operator">=</span> deadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 当执行完毕(不存在下一个执行单元), 提交整个DOM树</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nextUnitOfWork <span class="token operator">&amp;&amp;</span> wipRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">commitRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>workLoop<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>workLoop<span class="token punctuation">)</span></code></pre></div>
<h3>3.2 对 Fiber 节点的处理顺序——DFS</h3>
<p>由前文我们可知, Fiber 节点通过 <code class="language-text">return</code> <code class="language-text">child</code> <code class="language-text">sibling</code> 三个属性相互连接, 整体构成一个单向链表结构,其调度方式就是 深度优先遍历 :</p>
<ol>
<li>以 wipFiber 树的 Root 节点作为第一个执行单元;</li>
<li>若当前执行单元存在 child 节点, 则将 child 节点作为下一个执行单元;</li>
<li>重复 2, 直至当前执行单元无 child;</li>
<li>若当前执行单元存在 sibling 节点, 则将 sibling 节点作为下一个执行单元, 并回到 2;</li>
<li>若当前执行单元无 child 且无 sibling, 返回到父节点, 并回到 4;</li>
<li>重复 5; 直至回到 Root 节点, 执行完毕, 将 <code class="language-text">fiberRoot.current</code> 只为 wipFiber 树的根节点.</li>
</ol>
<p>以上步骤说明, Fiber 节点通过 <code class="language-text">child</code> → <code class="language-text">sibling</code> → <code class="language-text">return</code> 的顺序进行深度优先遍历“处理”, 而后更新 Fiber 树. 那么如何“处理”Fiber 节点呢?</p>
<h3>3.3 对 Fiber 节点的处理过程</h3>
<p>对 Fiber 节点的处理就是执行一个 <code class="language-text">performUnitOfWork</code> 方法, 它接收一个将要处理的 Fiber 节点, 然后完成以下工作:</p>
<ol>
<li>
<p>完善构建 Fiber 节点: 创建 DOM 并获取 <code class="language-text">children</code></p>
<ul>
<li>对于 HostComponent 和 ClassComponent, 根据 Fiber 中的相关属性, 创建 DOM 节点并赋给 <code class="language-text">Fiber.stateNode</code> 属性;</li>
<li>对于 FunctionComponent, 直接通过函数调用获取其 children: <code class="language-text">Fiber.type(Fiber.props)</code></li>
</ul>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// 执行工作单元,并返回下一个工作单元</span>
<span class="token keyword">function</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 构建当前节点的fiber</span>
 <span class="token keyword">const</span> isFunctionComponent <span class="token operator">=</span> fiber<span class="token punctuation">.</span>type <span class="token keyword">instanceof</span> <span class="token class-name">Function</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>isFunctionComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span>fiber<span class="token punctuation">)</span>
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   <span class="token function">updateHostComponent</span><span class="token punctuation">(</span>fiber<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// 处理子节点, 构建Fiber树</span>
 <span class="token keyword">const</span> elements <span class="token operator">=</span> fiber<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children
 <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> elements<span class="token punctuation">)</span>

 <span class="token comment">// TODO: 返回下一个执行单元</span>
 <span class="token comment">// fiber.child || fiber.sibling || fiber.return</span>
<span class="token punctuation">}</span>

<span class="token comment">// Class/Host组件: 创建DOM</span>
<span class="token keyword">function</span> <span class="token function">updateHostComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fiber<span class="token punctuation">.</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   fiber<span class="token punctuation">.</span>dom <span class="token operator">=</span> <span class="token function">createDom</span><span class="token punctuation">(</span>fiber<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> fiber<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新Function组件, Function组件需要从返回值获取子组件</span>
<span class="token comment">// 注意: Function组件无DOM</span>
<span class="token keyword">function</span> <span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 初始化hooks</span>
 wipFiber <span class="token operator">=</span> fiber
 hookIndex <span class="token operator">=</span> <span class="token number">0</span>
 fiber<span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
 <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token punctuation">[</span>fiber<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>fiber<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// Function组件返回children</span>
 <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// TODO: reconcileChildren处理子节点,见第3步</span></code></pre></div>
</li>
<li>
<p>通过 <code class="language-text">Fiber.alternate</code> 获取 <code class="language-text">oldFiber</code> , 即上一次更新后的 Fiber 值, 然后在下一步中构建和 Diff 当前 Fiber 的 <code class="language-text">children</code> .</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">wipFiber<span class="token punctuation">,</span> elements</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> oldFiber <span class="token operator">=</span> wipFiber<span class="token punctuation">.</span>alternate <span class="token operator">&amp;&amp;</span> wipFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>child
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
</li>
<li>
<p>构建 <code class="language-text">children</code> Fibers, 对于每个子 Fiber, 同步地完成以下工作:</p>
<ul>
<li>构建 Fiber 链表: 为每个子元素创建 Fiber, 并将父 Fiber 的 <code class="language-text">child</code> 属性指向第一个子 Fiber, 然后按顺序将子 Fiber 的 <code class="language-text">sibling</code> 属性指向下一个子 Fiber;</li>
<li>对比(Diffing)新旧 Fiber 节点的 <code class="language-text">type</code> <code class="language-text">props</code> <code class="language-text">key</code> 等属性, 确定节点是可以直接复用、替换、更新还是删除, 需要更新的 Fiber 节点在其 <code class="language-text">effectTag</code> 属性中打上 <code class="language-text">Update</code> <code class="language-text">Placement</code> <code class="language-text">PlacementAndUpdate</code> <code class="language-text">Deletion</code> 等标记, 以在提交更新阶段进行处理.</li>
</ul>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">wipFiber<span class="token punctuation">,</span> elements</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> oldFiber <span class="token operator">=</span> wipFiber<span class="token punctuation">.</span>alternate <span class="token operator">&amp;&amp;</span> wipFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>child<span class="token punctuation">;</span>
 <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token keyword">let</span> prevSibling <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

 <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length <span class="token operator">||</span> oldFiber <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> element <span class="token operator">=</span> elements<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> newFiber <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

   <span class="token comment">// Compare oldFiber to element</span>
   <span class="token keyword">const</span> sameType <span class="token operator">=</span> oldFiber <span class="token operator">&amp;&amp;</span> element <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>type <span class="token operator">===</span> oldFiber<span class="token punctuation">.</span>type<span class="token punctuation">;</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>sameType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// update the node</span>
     newFiber <span class="token operator">=</span> <span class="token punctuation">{</span>
       type<span class="token operator">:</span> oldFiber<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
       props<span class="token operator">:</span> element<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
       dom<span class="token operator">:</span> oldFiber<span class="token punctuation">.</span>dom<span class="token punctuation">,</span>
       parent<span class="token operator">:</span> wipFiber<span class="token punctuation">,</span>
       alternate<span class="token operator">:</span> oldFiber<span class="token punctuation">,</span>
       effectTag<span class="token operator">:</span> <span class="token string">"UPDATE"</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>sameType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// add this node</span>
     newFiber <span class="token operator">=</span> <span class="token punctuation">{</span>
       type<span class="token operator">:</span> element<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
       props<span class="token operator">:</span> element<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
       dom<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
       parent<span class="token operator">:</span> wipFiber<span class="token punctuation">,</span>
       alternate<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
       effectTag<span class="token operator">:</span> <span class="token string">"PLACEMENT"</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>oldFiber <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>sameType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// delete the oldFiber's node</span>
     oldFiber<span class="token punctuation">.</span>effectTag <span class="token operator">=</span> <span class="token string">"DELETION"</span><span class="token punctuation">;</span>
     deletions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>oldFiber<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>oldFiber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     oldFiber <span class="token operator">=</span> oldFiber<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     wipFiber<span class="token punctuation">.</span>child <span class="token operator">=</span> newFiber<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     prevSibling <span class="token operator">=</span> newFiber<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   prevSibling <span class="token operator">=</span> newFiber<span class="token punctuation">;</span>
   index<span class="token operator">++</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span></code></pre></div>
</li>
<li>
<p>按 DFS 顺序返回下一个工作单元, 示例代码如下:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">if</span> <span class="token punctuation">(</span>fiber<span class="token punctuation">.</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> fiber<span class="token punctuation">.</span>child
<span class="token punctuation">}</span>
<span class="token keyword">let</span> nextFiber <span class="token operator">=</span> fiber
<span class="token keyword">while</span> <span class="token punctuation">(</span>nextFiber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>nextFiber<span class="token punctuation">.</span>sibling<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> nextFiber<span class="token punctuation">.</span>sibling
 <span class="token punctuation">}</span>
 nextFiber <span class="token operator">=</span> nextFiber<span class="token punctuation">.</span>parent
<span class="token punctuation">}</span></code></pre></div>
</li>
</ol>
<p>当 DFS 过程回到根节点时, 表明本次更新的 wipFiber 树 构建完成, 进入下一步的提交更新阶段.</p>
<h3>3.4 提交更新阶段</h3>
<p>在进入本阶段时, 新的 Fiber 树已构建完成, 需要进行替换、更新或删除的 Fiber 节点也在其 <code class="language-text">effectTag</code> 中进行了标记, 所以本阶段第一个工作就是根据 <code class="language-text">effectTag</code> 操作真实 DOM.</p>
<p>为了避免从头再遍历 Fiber 树寻找具有 <code class="language-text">effectTag</code> 属性的 Fiber, 在上一步 Fiber 树的构建过程中保存了一条需要更新的 Fiber 节点的单向链表 <code class="language-text">effectList</code> , 并将此链表的头节点存储在 Fiber 树根节点的 <code class="language-text">firstEffect</code> 属性中, 同时这些 Fiber 节点的 <code class="language-text">updateQueue</code> 属性中也保存了需要更新的 <code class="language-text">props</code> .</p>
<p>除了更新真实 DOM 外, 在提交更新阶段还需要在特定阶段调用和处理生命周期方法、执行 Hooks 操作, 本文不再详述.</p>
<p>在此参考了 <a href="https://pomb.us/build-your-own-react/">https://pomb.us/build-your-own-react/</a> 中提供的 <code class="language-text">useState</code> Hook 的实现代码, 有助于理解在执行 <code class="language-text">setState</code> 方法后都发生了什么:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initial</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断上一次渲染是否存在此Hook,如果存在就使用上一个state,否则创建新的hook并更新索引</span>
  <span class="token keyword">const</span> oldHook <span class="token operator">=</span>
    wipFiber<span class="token punctuation">.</span>alternate <span class="token operator">&amp;&amp;</span>
    wipFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>hooks <span class="token operator">&amp;&amp;</span>
    wipFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>hooks<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>
  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token punctuation">{</span>
    state<span class="token operator">:</span> oldHook <span class="token operator">?</span> oldHook<span class="token punctuation">.</span>state <span class="token operator">:</span> initial<span class="token punctuation">,</span>
    queue<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 每次执行setState时,将action加入此队列,并在下一次渲染时执行</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 下一次渲染时, 获取执行队列并逐步执行, 使得state保持最新</span>
  <span class="token keyword">const</span> actions <span class="token operator">=</span> oldHook <span class="token operator">?</span> oldHook<span class="token punctuation">.</span>queue <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  actions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    hook<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">(</span>hook<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// setState方法: 将action添加到执行队列并触发渲染, 在下一次渲染时执行此action</span>
  <span class="token keyword">const</span> <span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    hook<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
    <span class="token comment">// 执行setState后应重新触发渲染</span>
    wipRoot <span class="token operator">=</span> <span class="token punctuation">{</span>
      dom<span class="token operator">:</span> currentRoot<span class="token punctuation">.</span>dom<span class="token punctuation">,</span>
      props<span class="token operator">:</span> currentRoot<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
      alternate<span class="token operator">:</span> currentRoot<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    nextUnitOfWork <span class="token operator">=</span> wipRoot
    deletions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  wipFiber<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span>
  hookIndex<span class="token operator">++</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<h1>参考文献</h1>
<ul>
<li>React 官方文档与相关源码</li>
<li><a href="https://pomb.us/build-your-own-react/">https://pomb.us/build-your-own-react/</a></li>
<li><a href="https://react.iamkasong.com/renderer/beforeMutation.html#commitbeforemutationeffects">https://react.iamkasong.com</a></li>
</ul></section><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/static/cb0348da83085f341829f81b843fa542/d4bf4/profile-pic.avif 50w,/static/cb0348da83085f341829f81b843fa542/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/static/cb0348da83085f341829f81b843fa542/3faea/profile-pic.webp 50w,/static/cb0348da83085f341829f81b843fa542/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/static/cb0348da83085f341829f81b843fa542/e5610/profile-pic.png" data-srcset="/static/cb0348da83085f341829f81b843fa542/e5610/profile-pic.png 50w,/static/cb0348da83085f341829f81b843fa542/e9b55/profile-pic.png 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/cb0348da83085f341829f81b843fa542/d4bf4/profile-pic.avif 50w,/static/cb0348da83085f341829f81b843fa542/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/static/cb0348da83085f341829f81b843fa542/3faea/profile-pic.webp 50w,/static/cb0348da83085f341829f81b843fa542/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/static/cb0348da83085f341829f81b843fa542/e5610/profile-pic.png" srcSet="/static/cb0348da83085f341829f81b843fa542/e5610/profile-pic.png 50w,/static/cb0348da83085f341829f81b843fa542/e9b55/profile-pic.png 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div><p><strong>佚树</strong> 的个人博客</p><p>关于前端、音乐与生活</p></div></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/online-editor/">← <!-- -->在线编辑器实现浅析</a></li><li></li></ul></nav></main><footer><a href="https://www.github.com/hrayd/">github</a> · <a href="https://www.zhihu.com/people/artyhacker">zhihu</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/react/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-97863347e1e2ea8cfcbd.js"],"app":["/app-065bd1c7906a1152e68e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f1bde5534fbdc04f234a.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a61f5dba934ef8f22a44.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-a4be0f194c3fdbe3e336.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-97982a6270918782dbd4.js"]};/*]]>*/</script><script src="/polyfill-97863347e1e2ea8cfcbd.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-97982a6270918782dbd4.js" async=""></script><script src="/commons-05ebe9de21711bd0a6d1.js" async=""></script><script src="/app-065bd1c7906a1152e68e.js" async=""></script><script src="/framework-e954ed135b27c92e5196.js" async=""></script><script src="/webpack-runtime-523b8afb0042468c77d7.js" async=""></script></body></html>